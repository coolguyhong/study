## 웹 서비스 서버 구성의 모범 사례

### 3.1 기본적인 구성

#### 풀스택을 1대의 시스템으로 구성하기

- Web: 클라이언트의 접속, 데이터 전송, 정적 데이터 전달, 동적 데이터 중계, 동적 데이터 생성, 애플리케이션 로직
- DB: 데이터베이스의 가동 및 데이터베이스의 데이터 보관
- File: 파일 형식의 데이터 보관, 화상 및 프로그램 파일 등을 보관

#### 시스템 구성 변경의 기초

##### 패턴1. 웹 서버 X 1, 데이터베이스 서버 X 1 구성 - 기능 분할

- 1대로 서버의 스펙이 부족할 때, 이를 해결하기 위해 적용
- DB만 분할하는 경우, DB및 File을 함께 분할하는 경우가 있음


##### 패턴2. 웹 서버 X 2 구성 - 다중화

- 서버1(운용 서버)에 어떤 문제가 생긴 경우, 서버1 대신 서버2를 이용하는 방법
- 전제 조건으로 DB와 File은 어떤 방법으로든 데이터 동기화해야 함


##### 패턴3. 웹 서버 X 2, 데이터베이스 서버 X 1 구성 - 다중화, 기능 분할, 스케일 아웃

- 패턴1에서 Web측의 성능 문제가 해결되지 않을 때 적용
- Web과 DB를 별도의 서버로 나누어 분업시킴으로써 서버의 리소스 편중에 따른 성능 저하를 방지
- Web서버도 2대로 나누어 사용함으로써 시스템 전체의 성능을 향상시킴


##### 패턴4. 웹 서버 X 2, 데이터베이스 서버 X 2 구성 - 다중화, 기능 분할, 스케일 아웃

- Web의 다중화 부하 분산, DB의 다중화 가능


### 3.2 부하 분산(로드밸런싱)의 기초 지식

#### 로드밸런싱의 두 가지 종류

- 부하의 분산의 목적으로 사용하며, 다중화의 역할을 하기도 함
- 웹 서버에 엑세스할 때 로드밸런싱을 사용하는 경우가 많지만,
- 웹 서버에서 애플리케이션 서버(AP) 또는 AP 서버에서 DB 서버로의 액세스 등 시스템 안에서도 로드밸런싱 함

##### 로드밸런서의 구조

- 클라이언트가 서버 측으로 액세스할 때마다 연결할 서버를 변경함으로써, 한 명으로부터의 대량 액세스도 분산이 가능

##### DNS 라운드로빈의 구조

- 클라이언트 측의 동작에 의존적인 방법
- DNS에서의 IP주소 설정 예
    + www IN A 192.168.0.11
    + www IN A 192.168.0.12
- 액세스 흐름
    1. 클라이언트로부터 DNS 서버로 질의
    2. DNS 서버로부터 클라이언트로 응답. 아래 중 어느 하나를 불규칙한 순서로 응답
    3. 대개의 클라이언트는 첫 번째 IP 주소를 이용. 보통의 브라우저는 첫 번째 IP 접속할 수 없는 경우, 두 번째 IP 주소로 다시 시도
- 클라이언트 측의 OS나 브라우저에 의존적인 방식

##### 로드밸런서로 할 것인가 DNS 라운드로빈으로 할 것인가

- 로드밸런서는 확실하게 분산할 수 있음
- 서비스를 중지하지 않고도 업데이트 등을 할 수 있음
- DNS 라운드로빈의 이점은 추가 설비가 필요하지 않다는 것
